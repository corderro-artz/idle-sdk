<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>idle-sdk Web Demo</title>
    <link rel="manifest" href="manifest.webmanifest" />
    <meta name="theme-color" content="#0f141b" />
    <link rel="icon" href="icon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="styles.css?v=53" />
    <script type="importmap">
        {
            "imports": {
                "three": "./vendor/three/three.module.min.js"
            }
        }
    </script>
</head>

<body>
    <div id="app" class="app">
        <header class="app-header">
            <div class="brand">
                <span class="brand-title">idle-sdk Web Demo</span>
                <span class="dot">‚Ä¢</span>
                <span id="saveStatus" class="subtle">Ready</span>
            </div>
            <div class="header-actions">
                <button id="openTheme" class="button ghost">üé® Theme</button>
                <button id="openErrors" class="button ghost hidden">‚ö† Errors</button>
                <button id="openDebug" class="button ghost dev-only">üõ† Debug</button>
            </div>
        </header>

        <div class="layout">
            <aside id="leftPanel" class="panel left">
                <section class="card">
                    <div class="card-header">
                        <span>üó∫ World</span>
                    </div>
                    <ul id="worldList" class="list"></ul>
                </section>

                <section class="card">
                    <div class="card-header">
                        <span>üíº Wallet</span>
                    </div>
                    <ul id="walletList" class="list"></ul>
                </section>

                <section class="card">
                    <div class="card-header">
                        <span>üìà Skills</span>
                    </div>
                    <ul id="skillsList" class="list"></ul>
                </section>
            </aside>

            <div id="splitterVertical" class="splitter vertical"></div>

            <main id="rightPanel" class="panel right">
                <section class="card skill-context tabs">
                    <div class="card-header">
                        <span>‚ú® Skill Context</span>
                    </div>
                    <div class="tabs-header">
                        <button class="tab-button active" data-tab="context">‚ú® Context</button>
                        <button class="tab-button" data-tab="inventory">üéí Inventory</button>
                        <button class="tab-button" data-tab="progression">üèÅ Progression</button>
                        <button class="tab-button" data-tab="systems">‚öô Systems</button>
                    </div>
                    <div class="tabs-content">
                        <div class="tab-panel active" data-panel="context">
                            <div class="skill-grid">
                                <div class="skill-ring">
                                    <div class="ring-wrap">
                                        <div id="contextRing" class="xp-ring">
                                            <svg id="contextRingSvg" class="xp-ring-svg" viewBox="0 0 100 100"
                                                aria-hidden="true">
                                                <defs>
                                                    <linearGradient id="ringGradient" x1="0%" y1="0%" x2="100%"
                                                        y2="100%">
                                                        <stop offset="0%" stop-color="#f6c8ff" />
                                                        <stop offset="100%" stop-color="#b7f7ff" />
                                                    </linearGradient>
                                                </defs>
                                                <circle class="ring-track" cx="50" cy="50" r="38"></circle>
                                                <circle id="contextRingProgress" class="ring-progress" cx="50" cy="50"
                                                    r="38" stroke="url(#ringGradient)"></circle>
                                            </svg>
                                            <div class="ring-inner">
                                                <div id="skillName" class="ring-title">SKILL</div>
                                                <div class="ring-level">
                                                    <span class="ring-level-label">LVL</span>
                                                    <span id="skillLevel" class="ring-level-value">1</span>
                                                </div>
                                                <div id="skillDetails" class="ring-xp">0 / 0 XP</div>
                                            </div>
                                        </div>
                                        <span id="contextRingTip" class="ring-tip" aria-hidden="true"></span>
                                        <div id="contextRingParticles" class="ring-particles" aria-hidden="true"></div>
                                    </div>
                                </div>
                                <div class="skill-info">
                                    <div class="skill-icon fancy">
                                        <span class="icon-wobble">
                                            <img id="skillIconImg" class="skill-icon-image" alt="" />
                                            <span id="skillIcon" class="skill-icon-emoji">‚ú®</span>
                                        </span>
                                    </div>
                                    <div id="comboMeter" class="combo-meter">
                                        <div class="combo-meter-header">
                                            <span class="combo-label">Combo Bonus</span>
                                            <span id="comboValue" class="combo-value">+0.00%</span>
                                        </div>
                                        <div class="combo-bar">
                                            <div id="comboFill" class="combo-fill"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="skill-task">
                                    <div id="activeTaskBadge" class="active-task-badge"></div>
                                    <ul id="taskList" class="list task-list"></ul>
                                    <button id="taskAction" class="button primary">Train</button>
                                    <div id="taskActionHint" class="subtle"></div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-panel" data-panel="inventory">
                            <div class="panel-section">
                                <div class="section-title">üì¶ Inventory</div>
                                <ul id="inventoryList" class="list"></ul>
                            </div>
                            <div class="panel-section">
                                <div class="section-title">üõ° Equipment</div>
                                <ul id="equipmentList" class="list"></ul>
                            </div>
                        </div>
                        <div class="tab-panel" data-panel="progression">
                            <div class="panel-section">
                                <div class="section-title">üóí Quests</div>
                                <ul id="questList" class="list"></ul>
                            </div>
                            <div class="panel-section">
                                <div class="section-title">üèÜ Achievements</div>
                                <ul id="achievementList" class="list"></ul>
                            </div>
                            <div class="panel-section">
                                <div class="section-title">üìö Collections</div>
                                <ul id="collectionList" class="list"></ul>
                            </div>
                        </div>
                        <div class="tab-panel" data-panel="systems">
                            <div class="panel-section">
                                <div class="section-title">‚öî Combat Log</div>
                                <ul id="combatList" class="list"></ul>
                            </div>
                            <div class="panel-section">
                                <div class="section-title">üß∞ Crafting</div>
                                <ul id="craftingList" class="list"></ul>
                            </div>
                            <div class="panel-section">
                                <div class="section-title">ü™ô Trade</div>
                                <ul id="tradeList" class="list"></ul>
                            </div>
                            <div class="panel-section">
                                <div class="section-title">üé≤ Layered Generator</div>
                                <ul id="generatorList" class="list"></ul>
                            </div>
                            <div class="panel-section">
                                <div class="section-title">üìñ Compendium</div>
                                <ul id="compendiumList" class="list"></ul>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <div id="inventoryPopover" class="inventory-popover hidden" role="dialog" aria-hidden="true">
        <div class="inventory-popover-card">
            <div class="inventory-popover-header">
                <img id="popoverIcon" class="inventory-popover-icon" alt="" />
                <div>
                    <div id="popoverName" class="inventory-popover-title">Item</div>
                    <div id="popoverDesc" class="inventory-popover-desc">Description</div>
                </div>
            </div>
            <div class="inventory-popover-stats">
                <div id="popoverStack" class="inventory-popover-stat inventory-popover-stack">Stack 0 / 0</div>
                <div id="popoverValue" class="inventory-popover-stat inventory-popover-values">
                    <img src="assets/icons/cash_dark.png" alt="Cash" class="inventory-popover-cash" />
                    0
                </div>
            </div>
            <div class="inventory-popover-graph">
                <canvas id="popoverGraph" width="220" height="60"></canvas>
            </div>
        </div>
    </div>

    <div id="modelViewerDialog" class="theme-dialog hidden" role="dialog" aria-modal="true">
        <div class="theme-panel model-viewer-panel">
            <div class="theme-header">
                <div>
                    <div id="modelViewerTitle" class="overlay-title">3D Model Viewer</div>
                    <div class="subtle">Drag to rotate ‚Ä¢ Right-drag or two-finger drag to pan ‚Ä¢ Scroll/pinch to zoom
                    </div>
                </div>
                <div class="button-row">
                    <button id="modelViewerReset" class="button ghost">Reset</button>
                    <button id="modelViewerClose" class="button ghost">‚úï</button>
                </div>
            </div>
            <div class="theme-body">
                <div id="modelViewerViewport" class="model-viewer-viewport">
                    <div id="modelViewerStatus" class="model-viewer-status hidden"></div>
                </div>
                <div class="model-viewer-controls">
                    <div class="model-viewer-control-group">
                        <button id="modelViewerRotateLeft" class="button ghost" title="Rotate left">‚ü≤</button>
                        <button id="modelViewerRotateRight" class="button ghost" title="Rotate right">‚ü≥</button>
                        <button id="modelViewerAutoRotate" class="button ghost" title="Toggle auto-rotate">Auto
                            Rotate</button>
                    </div>
                    <div class="model-viewer-control-group model-viewer-zoom">
                        <button id="modelViewerZoomOut" class="button ghost" title="Zoom out">‚àí</button>
                        <input id="modelViewerZoom" class="model-viewer-zoom-slider" type="range" min="0.5" max="2.5"
                            step="0.01" value="1" />
                        <button id="modelViewerZoomIn" class="button ghost" title="Zoom in">Ôºã</button>
                        <span id="modelViewerZoomValue" class="subtle">100%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="themeDialog" class="theme-dialog hidden" role="dialog" aria-modal="true">
        <div class="theme-panel">
            <div class="theme-header">
                <div>
                    <div class="overlay-title">Theme Manager</div>
                    <div class="subtle">Realtime themes ‚Ä¢ Built-in + content packs</div>
                </div>
                <div class="button-row">
                    <button id="reloadThemesBtn" class="button ghost">Reload</button>
                    <button id="closeTheme" class="button ghost">‚úï</button>
                </div>
            </div>
            <div class="theme-body">
                <div class="panel-section">
                    <div class="section-title">Available Themes</div>
                    <div id="themeList" class="theme-list"></div>
                </div>
                <div class="panel-section">
                    <div class="section-title">Edit Theme (JSON)</div>
                    <textarea id="themeJson" class="text-input" rows="8"></textarea>
                    <div class="button-row">
                        <button id="applyThemeJson" class="button primary">Apply</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="errorDialog" class="theme-dialog hidden" role="dialog" aria-modal="true">
        <div class="theme-panel error-panel">
            <div class="theme-header">
                <div>
                    <div class="overlay-title">Error Log</div>
                    <div class="subtle">Runtime warnings and errors</div>
                </div>
                <div class="button-row">
                    <button id="copyErrors" class="button ghost">üìã Copy</button>
                    <button id="clearErrors" class="button ghost">Clear</button>
                    <button id="closeErrors" class="button ghost">‚úï</button>
                </div>
            </div>
            <div class="theme-body error-body">
                <div class="panel-section">
                    <div class="section-title">Recent</div>
                    <div id="errorList" class="theme-list"></div>
                </div>
                <div class="panel-section">
                    <div class="section-title">Details</div>
                    <textarea id="errorDetails" class="text-input" rows="10" readonly></textarea>
                </div>
            </div>
        </div>
    </div>

    <div id="debugOverlay" class="overlay hidden dev-only" role="dialog" aria-modal="true">
        <div class="overlay-panel">
            <div class="overlay-header">
                <div>
                    <div class="overlay-title">Debug Console</div>
                    <div class="subtle">Diagnostics ‚Ä¢ Controls ‚Ä¢ Content Explorer</div>
                </div>
                <div class="button-row">
                    <button id="toggleDebugSize" class="button ghost" title="Expand debug panel">‚§¢</button>
                    <button id="closeDebug" class="button ghost">‚úï</button>
                </div>
            </div>
            <div class="overlay-tabs">
                <button class="tab-button active" data-tab="overview">üß≠ Overview</button>
                <button class="tab-button" data-tab="controls">üéõ Controls</button>
                <button class="tab-button" data-tab="content">üì¶ Content</button>
                <button class="tab-button" data-tab="preview">üßä 3D Preview</button>
            </div>
            <div class="overlay-body">
                <div class="tab-panel layout-grid overview-grid has-subtabs active" data-panel="overview">
                    <div class="subtab-bar">
                        <button class="subtab-button active" data-subtab="diagnostics">üìä Diagnostics</button>
                        <button class="subtab-button" data-subtab="pinned">üìå Pinned</button>
                        <button class="subtab-button" data-subtab="shortcuts">‚ö° Shortcuts</button>
                    </div>
                    <div class="subtab-panel active" data-subpanel="diagnostics">
                        <div class="panel-section debug-controls-section">
                            <div class="section-title">Debug Controls</div>
                            <div class="button-row">
                                <button id="debugControlsToggle" class="button primary debug-controls-toggle">Debug
                                    Console:
                                    On</button>
                                <span id="debugControlsBadge" class="runtime-badge runtime-badge-success">Active</span>
                            </div>
                            <div class="subtle">Controls editing, pins, and debug actions. Always available to
                                re-enable.
                            </div>
                            <div class="button-row">
                                <button id="resetDevBtn" class="button ghost dev-only">‚ôª Reset Dev</button>
                            </div>
                        </div>
                        <div class="panel-section">
                            <div class="section-title">Layout Mode</div>
                            <div class="button-row">
                                <button id="formFactorAuto" class="button ghost">Auto: On</button>
                                <span id="formFactorStatus" class="runtime-badge runtime-badge-muted">Auto
                                    (Desktop)</span>
                            </div>
                            <div class="button-row">
                                <button id="formFactorDesktop" class="button ghost">Desktop</button>
                                <button id="formFactorTablet" class="button ghost">Tablet</button>
                                <button id="formFactorMobile" class="button ghost">Mobile</button>
                            </div>
                            <div class="subtle">Manual layout buttons are locked when Auto is on.</div>
                        </div>
                        <div class="panel-section">
                            <div class="section-title">Runtime Diagnostics</div>
                            <div class="runtime-grid">
                                <div class="runtime-card">
                                    <div class="runtime-card-title">Performance</div>
                                    <div id="runtimePerf" class="runtime-list">
                                        <div id="debugFps" class="runtime-line"
                                            title="FPS is measured per render; target pacing skips frames to maintain a steady cadence.">
                                            FPS: --</div>
                                        <div id="debugRefreshHz" class="runtime-line"
                                            title="Display refresh estimate from requestAnimationFrame. Timer mode may not update this value.">
                                            Display Hz: --</div>
                                        <div id="debugTickRate" class="runtime-line">Tick rate: --</div>
                                        <div id="debugUiUpdates" class="runtime-line">UI updates/frame: --</div>
                                    </div>
                                </div>
                                <div class="runtime-card">
                                    <div class="runtime-card-title">Session</div>
                                    <div id="runtimeSession" class="runtime-list">
                                        <div id="debugOnline" class="runtime-line">Online</div>
                                        <div id="debugOffline" class="runtime-line">Last offline: n/a</div>
                                        <div id="runtimeHost" class="runtime-line">Host: --</div>
                                        <div id="runtimeProtocol" class="runtime-line">Protocol: --</div>
                                        <div id="runtimeDevMode" class="runtime-line">Dev Mode: --</div>
                                        <div id="runtimeUptime" class="runtime-line">Uptime: --</div>
                                        <div id="runtimeSaved" class="runtime-line">Last save: --</div>
                                    </div>
                                </div>
                                <div class="runtime-card">
                                    <div class="runtime-card-title">Renderer</div>
                                    <div id="runtimeRenderer" class="runtime-list"></div>
                                </div>
                                <div class="runtime-card">
                                    <div class="runtime-card-title">Engine</div>
                                    <div id="runtimeEngine" class="runtime-list"></div>
                                </div>
                                <div class="runtime-card">
                                    <div class="runtime-card-title">Storage</div>
                                    <div id="runtimeStorage" class="runtime-list"></div>
                                </div>
                                <div class="runtime-card">
                                    <div class="runtime-card-title">Errors</div>
                                    <div id="runtimeErrors" class="runtime-list"></div>
                                </div>
                                <div class="runtime-card runtime-graph">
                                    <div class="runtime-card-title">Frame Timeline</div>
                                    <canvas id="runtimeGraph" width="260" height="90"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="subtab-panel" data-subpanel="pinned">
                        <div class="panel-section">
                            <div class="section-title">Pinned</div>
                            <div id="pinnedInspector" class="inspector"></div>
                        </div>
                    </div>
                    <div class="subtab-panel" data-subpanel="shortcuts">
                        <div class="panel-section">
                            <div class="section-title">Shortcuts</div>
                            <div class="button-row">
                                <button id="tickBtn" class="button primary">‚è± Tick</button>
                                <button id="offlineBtn" class="button">‚è≤ Offline 10s</button>
                                <button id="saveBtn" class="button">üíæ Save</button>
                                <button id="loadBtn" class="button">üìÇ Load</button>
                            </div>
                            <div class="button-row">
                                <input id="tickBatchInput" class="text-input" type="number" min="1" step="1"
                                    value="60" />
                                <button id="tickBatchBtn" class="button">Run Ticks</button>
                                <span id="tickBatchTime" class="subtle">00:00:00:00</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-panel layout-grid" data-panel="controls">
                    <div class="panel-section">
                        <div class="section-title">View</div>
                        <div class="zoom-row">
                            <label for="zoomSlider" class="subtle">Zoom</label>
                            <input id="zoomSlider" type="range" min="0.75" max="1.5" step="0.01" value="1" />
                            <span id="zoomValue" class="subtle">100%</span>
                        </div>
                    </div>
                </div>
                <div class="tab-panel layout-grid has-subtabs" data-panel="content">
                    <div class="subtab-bar">
                        <button class="subtab-button active" data-subtab="data">üßæ Data</button>
                        <button class="subtab-button" data-subtab="packs">üì¶ Packs</button>
                        <button class="subtab-button" data-subtab="modules">üß© Modules</button>
                    </div>
                    <div class="subtab-panel active" data-subpanel="data">
                        <div class="panel-section">
                            <div class="section-title">Wallet</div>
                            <div id="walletInspector" class="inspector"></div>
                        </div>
                        <div class="panel-section">
                            <div class="section-title">Inventory</div>
                            <div id="inventoryInspector" class="inspector"></div>
                        </div>
                        <div class="panel-section">
                            <div class="section-title">Skills</div>
                            <div id="skillInspector" class="inspector"></div>
                        </div>
                    </div>
                    <div class="subtab-panel" data-subpanel="packs">
                        <div class="panel-section">
                            <div class="section-title">Content Packs</div>
                            <div id="contentPackInspector" class="inspector"></div>
                        </div>
                    </div>
                    <div class="subtab-panel" data-subpanel="modules">
                        <div class="panel-section">
                            <div class="section-title">Modules</div>
                            <div id="moduleInspector" class="inspector"></div>
                        </div>
                        <div class="panel-section">
                            <div class="section-title">External Module Loader</div>
                            <textarea id="externalModuleInput" class="text-input" rows="4"
                                placeholder='[{"id":"my-mod","name":"My Mod","version":"1.0.0","enabled":true,"properties":[{"id":"rate","label":"Rate","type":"number","value":1}]}]'></textarea>
                            <div class="button-row">
                                <button id="loadModulesBtn" class="button">Load Modules</button>
                                <button id="clearModulesBtn" class="button ghost">Clear</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-panel preview-stack" data-panel="preview">
                    <div class="panel-section">
                        <div class="section-title">3D Model Preview</div>
                        <div class="model-preview model-viewport" data-model="" data-label="3D Preview"
                            data-fallback="assets/icons/keno_dark.png" data-spin="true" data-wobble="false"></div>
                        <div class="button-row">
                            <button id="modelExpandBtn" class="button ghost">Expand Viewer</button>
                        </div>
                        <div class="subtle">Upload a GLB/GLTF/OBJ model to preview.</div>
                    </div>
                    <div class="panel-section">
                        <div class="section-title">Upload</div>
                        <div class="upload-row">
                            <input id="modelUploadInput" class="text-input" type="file" accept=".glb,.gltf,.obj" />
                            <button id="modelClearBtn" class="button ghost">Clear</button>
                        </div>
                        <div id="modelUploadName" class="subtle">No file selected.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/pixi.js@8.2.3/dist/pixi.min.js"></script>
    <script src="app.js?v=53" type="module"></script>
</body>

</html>
